{"name":"Cloud Wars game","tagline":"How to use the Needletail tools to build a Battleship inspired game","body":"<h1><img src=\"https://raw.github.com/pedro-ramirez-suarez/cloudwarsgame/master/CloudWars.Game/Images/logo.png\"/><h1>\r\n<img src=\"https://raw.github.com/pedro-ramirez-suarez/cloudwarsgame/master/CloudWars.Game/img/playing.jpg\"/>\r\n<h2>Before you run the game</h2>\r\n<p>\r\n    <ul>\r\n        <li>The Needletail Migrations library will create all the tables and populate initial data but you need at least MSSQL Express 2008 R2</li>\r\n        <li>Create a new database</li>\r\n        <li>\r\n            Modify the Default connection string on <code>web.config</code> to match your environment.\r\n        </li>\r\n      <li>\r\n        <a href=\"http://blogs.msdn.com/b/webdev/archive/2012/08/15/oauth-openid-support-for-webforms-mvc-and-webpages.aspx\">Enable and setup Open Auth </a>\r\n      </li>\r\n    </ul>\r\n    <h4>Important</h4>\r\n    <ul>\r\n        <li>The game is not compatible with any version of Internet Explorer.</li>\r\n        <li>Do not use IIS Express, SSE is not properly implemented on it, some events are lost or not sent live</li>\r\n    </ul>\r\n </p>     \r\n\r\n<h2>Why these libraries</h2>\r\n<p>There are a lot of good libraries out there, but sometimes only the creator of the library or people with the \"right\" problem will \r\ntry new libraries and then appreciate it's features, so my purpose was to create an application that shows what the Needletail libraries can do for you.\r\n</p>\r\n\r\n\r\n<h2>Architecture and points of interest</h2>\r\n<img src=\"https://raw.github.com/pedro-ramirez-suarez/cloudwarsgame/master/architecture.jpg\"/>\r\n<p>We use Needletail's Micro ORM to access the database, since the library provide fast access to the data, a social game it's an excelent scenario for it, Needletail MVC is used to push/send events on real time to the browser without breaking up your MVC pattern.</p>\r\n\r\n<h2>How needletail tools were used</h2>\r\n<h4>Needletail.DataAccess</h4>\r\n<p>The CloudWars.DataAccess library project shows how Needletail.DataAccess was used, you can do the same thing in a few different ways with the library so instead of using the same approach, I use different approaches to get or modify data, a few samples are:</p>\r\n<ul>\r\n    <li>\r\n        <p>Get a challenge stored in the database</p>\r\n        <pre><code>return CloudWarsDB.Challenges.GetSingle( where: new { Id = challengeId } );</code></pre>\r\n    </li>\r\n    <li>\r\n        <p>Create a new challenge</p>\r\n        <pre>\r\n            <code>\r\n                var c = new Challenge { Id = Guid.NewGuid(), Player1 = fromId, Player2 = toId };\r\n                CloudWarsDB.Challenges.Insert(c);\r\n            </code>\r\n        </pre>\r\n    </li>\r\n    <li>\r\n        <p>update a player</p>\r\n        <pre>\r\n            <code>\r\n                CloudWarsDB.Players.UpdateWithWhere(values: values, where: where);\r\n            </code>\r\n        </pre>\r\n    </li>\r\n</ul>\r\n\r\n<h4>Needletail.DataAccess.Migratoins</h4>\r\n<p>Since we don't want to manually create the database, we use the Migrations library to automatically create and prepupulate the database for us.</p>\r\n<ul>\r\n    <li>\r\n        <p>Creating/updating the database on Global.asax</p>\r\n        <pre><code>Needletail.DataAccess.Migrations.Migrator.Migrate(\"DefaultConnection\",Server.MapPath(\"~\"));</code></pre>\r\n    </li>    \r\n</ul>\r\n\r\n\r\n<h4>Needletail.MVC</h4>\r\n<p>The purpose of the game is to interact in real time with your opponent as you are playing, there is a well known alternative for Needletail.MVC which is SignalR, but one thing that I don't like about it, is that it force you to follow some conventions and pattern, since the game\r\nwas developed with Asp.Net MVC 4, it does not feel natural to break your pattern to implement some parts of the functionality, so I decided to build a library for that purpose(with some limitations), here is how the library was used on the game</p>\r\n<ul>\r\n    <li>\r\n        Chatting with your opponent\r\n        <pre>\r\n            <code>\r\n                //This code is on the GameController\r\n                [HttpPost]\r\n                public TwoWayResult PlayerChat(string message, string clientId)\r\n                {\r\n                    //sanitize the message\r\n                    message = Encoder.HtmlEncode(message);\r\n                    dynamic call = new ClientCall { CallerId = Context.ConnectionId, ClientId = clientId };\r\n                    call.game.receiveMessage(message); //game.receiveMessage is a javascript method\r\n                    return new TwoWayResult(call);\r\n                }\r\n            </code>\r\n        </pre>\r\n    </li>\r\n    <li>\r\n        Invite your opponent to start the match\r\n        <pre>\r\n            <code>\r\n                //This code is on the GameController\r\n                [HttpPost]\r\n                public  TwoWayResult InvitePlayer(Guid matchId, string clientId)\r\n                {\r\n                    var player = factory.GetPlayerPresence().GetPlayerNameByClientId(Context.ConnectionId);\r\n            \r\n                    dynamic call = new ClientCall { CallerId = Context.ConnectionId, ClientId = clientId };\r\n                    call.game.inviteToMatch(matchId, player); //game.inviteToMatch is a javascript method\r\n                    return new TwoWayResult(call);\r\n                }\r\n            </code>\r\n        </pre>\r\n    </li>\r\n</ul>\r\n\r\nYou can read more about Needletail libraries <a href=\"http://pedro-ramirez-suarez.github.io/needletailtools/\" target=\"_blank\">here</a>\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}